env:
    TOKEN: "ENCRYPTED[e86bd9288d87d6cbe42a9b1be357737635cb4b01c1d4770fe601db837465ab2686f93608313a2c022ebf6a2e89d5735e]"
    CHATID: "ENCRYPTED[052814378f35776e15658eb93a6ba2d4659cdb62a8d3577d2b27cba97ccfc5c817d38f5722d924cdca2ba3abe4b64162]"
    GH_AUTH: "ENCRYPTED[8f497a3b6222fdda2e6bcde5bf9873fec8ed2f9e442cae085445c6a543193ad6b6289b37d7492a72cc80a7eddd5bcd7b]"
    CIRRUS_CLONE_DEPTH: "1"

kernel_task:
  name: DragonHeart build
  trigger_type: manual
  timeout_in: 120m
  container:
    image: panchajanya1999/archlinux:latest
    cpu: 8
    memory: 32G

  setup_env_script:
      - curl -fsSL "https://pkgbuild.com/~morganamilo/pacman-static/x86_64/bin/pacman-static" -o pacman-static && chmod +x pacman-static && mv pacman-static /usr/bin/
      - pacman-static -Syu --needed --noconfirm github-cli kmod
      - gh auth login --with-token <<< "$GH_AUTH"
      - sed -i '/E_ROOT/d' /usr/bin/makepkg
      - sed -i "s/PKGEXT='.pkg.tar.xz'/PKGEXT='.pkg.tar.zst'/" /etc/makepkg.conf
      - echo 'COMPRESSZST+=(--threads=0)' >> /etc/makepkg.conf
      - mkdir neutron-clang && cd neutron-clang && bash <(curl -s https://raw.githubusercontent.com/Neutron-Toolchains/antman/main/antman) -S && cd ..

  build_script:
      - env ci=y makepkg -s && curl -s https://bin.cyberknight777.dev/vkZQ/raw | bash

  artifacts:
      path: "*.pkg.tar.zst"
